<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sealyun | kubernetes安装</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.943dcab2.css" as="style"><link rel="preload" href="/assets/js/app.5766de4b.js" as="script"><link rel="preload" href="/assets/js/2.bc760f0a.js" as="script"><link rel="preload" href="/assets/js/8.dc94d2c7.js" as="script"><link rel="prefetch" href="/assets/js/10.ba812dff.js"><link rel="prefetch" href="/assets/js/11.eae79e90.js"><link rel="prefetch" href="/assets/js/12.97d9a5d9.js"><link rel="prefetch" href="/assets/js/3.f14dac27.js"><link rel="prefetch" href="/assets/js/4.1ba98b6c.js"><link rel="prefetch" href="/assets/js/5.61ef1bb1.js"><link rel="prefetch" href="/assets/js/6.71442395.js"><link rel="prefetch" href="/assets/js/7.7744ade8.js"><link rel="prefetch" href="/assets/js/9.8d4e5ae5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.943dcab2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://sealyun.com/img/logo.png" alt="sealyun | kubernetes安装" class="logo"> <span class="site-name can-hide">sealyun | kubernetes安装</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://store.lameleg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  离线包下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/faq/" class="nav-link router-link-exact-active router-link-active">常见问题</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">版本变更</a></div><div class="nav-item"><a href="/github/" class="nav-link">开源项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友情连接" class="dropdown-title"><span class="title">友情连接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://fuckcloudnative.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  云原生实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kuboard.cn/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kuboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.qikqiak.com/?utm_source=sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阳明的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://zhangguanzhang.github.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张馆长的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://store.lameleg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  离线包下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/faq/" class="nav-link router-link-exact-active router-link-active">常见问题</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">版本变更</a></div><div class="nav-item"><a href="/github/" class="nav-link">开源项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友情连接" class="dropdown-title"><span class="title">友情连接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://fuckcloudnative.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  云原生实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kuboard.cn/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kuboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.qikqiak.com/?utm_source=sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阳明的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://zhangguanzhang.github.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张馆长的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>重启机器kubelet起不来？</p></blockquote> <p>确保selinux swap 已经关闭。     swapoff -a&amp;&amp; setenforce 0&amp;&amp;systemctl start kubelet         执行后会拉起其他服务</p> <p>永久关闭swap:</p> <div class="language- extra-class"><pre class="language-text"><code>1. Identify configured swap devices and files with cat /proc/swaps.
2. Turn off all swap devices and files with swapoff -a.
3. Remove any matching reference found in /etc/fstab
</code></pre></div><p>永久关闭selinux:</p> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/sysconfig/selinux SELINUX=enforcing 改为 SELINUX=disabled 
</code></pre></div><blockquote><p>chrome 浏览器可能访问不了dashboard</p></blockquote> <p>是因为新版chrome安全检测太严格，不认自签证书，要解决可以使用火狐，或者自己买证书给dashboard配置上。      访问不了dashboard先检查pod有没有启动成功<code>kubectl get pod -n kube-system</code>，再在节点上用curl检查，如果能curl到 那就是浏览器的原因了。注意是https</p> <p>自己创建证书：</p> <p>1.用openssl创建证书</p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir certs
$ cd certs
$ openssl genrsa -des3 -passout pass:x -out dashboard.pass.key 2048
$ openssl rsa -passin pass:x -in dashboard.pass.key -out dashboard.key
$ rm dashboard.pass.key
$ openssl req -new -key dashboard.key -out dashboard.csr
$ openssl x509 -req -sha256 -days 365 -in dashboard.csr -signkey dashboard.key -out dashboard.crt
$ rm -rf dashboard.csr
</code></pre></div><p>2.删除dashboard,这个文件在解压包里找
$ kubectl delete -f kubernetes-dashboard.yaml</p> <p>3.创建kubernetes-dashboard-secret
$ kubectl create secret generic kubernetes-dashboard-certs --from-file=$HOME/certs -n kube-system</p> <p>4.创建新的dashboard
$ kubectl create-f kubernetes-dashboard.yaml</p> <blockquote><p>修改calico pod地址段?</p></blockquote> <p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/" target="_blank" rel="noopener noreferrer">kubeadm文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  要改两个地方1. kubeadm配置：</p> <div class="language- extra-class"><pre class="language-text"><code>networking:
  dnsDomain: &lt;string&gt;
  serviceSubnet: &lt;cidr&gt;
  podSubnet: &lt;cidr&gt;   # 这里
</code></pre></div><ol start="2"><li>calico yaml配置:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    - name: FELIX_DEFAULTENDPOINTTOHOSTACTION
      value: &quot;ACCEPT&quot;
    # Configure the IP Pool from which Pod IPs will be chosen.
    - name: CALICO_IPV4POOL_CIDR
      value: &quot;192.168.122.0/24&quot;   # 这里
    - name: CALICO_IPV4POOL_IPIP
      value: &quot;always&quot;
    # Disable IPv6 on Kubernetes.
    - name: FELIX_IPV6SUPPORT
      value: &quot;false&quot;
</code></pre></div><blockquote><p>kubeadm join命令找不到了？</p></blockquote> <p>用这个 kubeadm token create --print-join-command</p> <blockquote><p>需要通过外网访问APIserver?</p></blockquote> <p>典型场景：通过阿里云floatingIP访问APIserver，这时需要把floatingip加入到证书里面，或者如keepalived的虚拟IP， 修改conf/kubeadm.yaml 加入以下字段：</p> <div class="language- extra-class"><pre class="language-text"><code>apiServerCertSANs:
  - 10.100.81.11   // 你的外网IP等
  - master01.bja.paas  //如果通过域名访问也需要加域名
</code></pre></div><p>然后重新init</p> <p>最后直接修改kubeconfig文件（~/.kube/config）里的IP即可，把这个文件拷贝到本机，就可以通过外网访问apiserver了</p> <blockquote><p>获取登录token:</p></blockquote> <p>admin token:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl describe secret `kubectl get secret |grep cluster-admin|awk '{print $1}'`|grep token|awk '{print $2}'|tail -1
</code></pre></div><p>dashboard service account token:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get secret $(kubectl get serviceaccount dashboard -o jsonpath=&quot;{.secrets[0].name}&quot;) -o jsonpath=&quot;{.data.token}&quot; | base64 --decode
</code></pre></div><p>或者使用<a href="https://github.com/fanux/fist" target="_blank" rel="noopener noreferrer">fist auth 模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>在这一步卡死，且docker ps没有任何容器起来，但是kubelet正常</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[init] this might take a minute or longer if the control plane images have to be pulled 
</code></pre></div><p>看/var/log/messages有如下日志</p> <div class="language- extra-class"><pre class="language-text"><code> RunPodSandbox from runtime service failed: rpc error: code = Unknown desc = failed to create a sandbox for pod &quot;kube-apiserver-istiohost&quot;: Error response from daemon: cgroup-parent for systemd cgroup should be a valid slice named as &quot;xxx.slice&quot;
</code></pre></div><p>这是docker版本与k8s兼容性问题，建议跟换docker版本。  我在1.13.1上出现过此问题,升级到了18.06.0-ce解决，不过具体版本可根据自己需求安装</p> <p>安装docker-ce:</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y yum-utils
yum-config-manager     --add-repo     https://download.docker.com/linux/centos/docker-ce.repo
yum-config-manager --disable docker-ce-edge
yum makecache fast
yum install docker-ce
</code></pre></div><blockquote><p>NodePort无法访问：iptables -P FORWARD ACCEPT</p></blockquote> <blockquote><p>failure loading ca certificate: the certificate is not valid yet</p></blockquote> <p>服务器时间不同步导致</p> <blockquote><p>coredns无法启动</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>.:53
2018/09/28 08:45:32 [INFO] CoreDNS-1.2.2
2018/09/28 08:45:32 [INFO] linux/amd64, go1.11, eb51e8b
CoreDNS-1.2.2
linux/amd64, go1.11, eb51e8b
2018/09/28 08:45:32 [INFO] plugin/reload: Running configuration MD5 = f65c4821c8a9b7b5eb30fa4fbc167769
2018/09/28 08:45:38 [FATAL] plugin/loop: Seen &quot;HINFO IN 4443432808327291531.7218519048545008660.&quot; more than twice, loop detected
</code></pre></div><p>修改宿主机的/etc/resolv.conf
内容：</p> <div class="language- extra-class"><pre class="language-text"><code>[root@iZrj9aqbeed7la2925ggzaZ ~]# cat /etc/resolv.conf
; generated by /usr/sbin/dhclient-script
nameserver 8.8.8.8
</code></pre></div><p>杀掉DNS pod即可</p> <blockquote><p>calico无法启动</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Readiness probe failed: calico/node is not ready: felix is not ready: Get http://localhost:9099/readiness: dial tcp [::1]:9099: connect: connection refused 
</code></pre></div><p>很可能是网卡发现有问题，calico虚拟化时没找对网卡，calico会经常找docker0网桥，导致clusterIP不通从而calico node连不上etcd</p> <p>解决办法：
配置好/etc/hosts</p> <p>或者修改网卡发现机制：
calico网卡发现 conf/net/calico.yaml文件：</p> <div class="language- extra-class"><pre class="language-text"><code>- name: IP_AUTODETECTION_METHOD
              value: &quot;interface=eth.*&quot;   # 如果你的网卡不是eth开头，换成自己的，在yaml文件里修改
</code></pre></div><p>还有可能是/etc/resove.conf配置错误，如果里面配置了一些search可能会导致calico无法启动，
解决方法是删除不需要的DNS配置,仅配置：</p> <div class="language- extra-class"><pre class="language-text"><code>nameserver 8.8.8.8
</code></pre></div><blockquote><p>kubeadm no default route错误</p></blockquote> <p>It picks the interface with the default gateway and listens to that.
所以配置好主机默认路由即可，就是default：</p> <div class="language- extra-class"><pre class="language-text"><code>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         169.254.1.1     0.0.0.0         UG    0      0        0 eth1
</code></pre></div><blockquote><p>1.14版本join时需要增加一个--master参数</p></blockquote> <p>为了兼容单master与多master的情况：</p> <div class="language- extra-class"><pre class="language-text"><code>kubeadm join 10.103.97.1:6443 --token 9vr73a.a8uxyaju799qwdjv \
    --master 10.103.97.100:6443 \
    --discovery-token-ca-cert-hash sha256:7c2e69131a36ae2a042a339b33381c6d0d43887e2de83720eff5359e26aec866
</code></pre></div><blockquote><p>1.14以上版本机器重启node节点notready</p></blockquote> <p>这与开机没有加载ipvs内核模块有关，首先请确保ipvs已经加载.
然后确保node kubelet已经正常启动
最后查看lvscare的pod有没有启动
如果都正常还是notready的话，重启lvscare pod即可</p> <div class="language- extra-class"><pre class="language-text"><code># Open ipvs
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4

cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
sysctl -w net.ipv4.ip_forward=1
systemctl stop firewalld &amp;&amp; systemctl disable firewalld
swapoff -a
setenforce 0
</code></pre></div><p>可以直接杀lvscare容器，kubelet会自动拉起</p> <blockquote><p>error execution phase preflight: couldn't validate the identity of the API</p></blockquote> <p>可能是token过期，需要在master上重新生成token再join:</p> <div class="language- extra-class"><pre class="language-text"><code>kubeadm token create --print-join-command
</code></pre></div><p>用<a href="https://github.com/fanux/sealos" target="_blank" rel="noopener noreferrer">sealos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>时,join别忘记加 <code>--master</code> 参数<a href="https://github.com/fanux/sealos" target="_blank" rel="noopener noreferrer">参考readme<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>kubelet能起来但是安装时卡住</p></blockquote> <p>有位朋友centos7.3上安装master时卡住， docker 1.13.1,原因是系统兼容性问题，如果发现安装过程中kubelet已经能起来了，而容器一个没起，可能就是这个原因，
起容器会报这个错：</p> <div class="language- extra-class"><pre class="language-text"><code> applying cgroup configuration for process caused \\\&quot;Cannot set property TasksAccounting, or unknown property.
</code></pre></div><p>解决办法：</p> <div class="language- extra-class"><pre class="language-text"><code>yum update
</code></pre></div><blockquote><p>kubelet起不来</p></blockquote> <p>在有些系统下可能会有这个问题：</p> <div class="language- extra-class"><pre class="language-text"><code>Executable path is not absolute: sh /usr/bin/kubelet-pre-start.sh
7月 22 13:59:21 ning systemd[1]: /etc/systemd/system/kubelet.service:7: Executable path is not absolute: sh /usr/bin/kubelet-pre-start.sh
</code></pre></div><p>因为找不到 <code>sh</code>这个命令导致</p> <p>修改 <code>kube/conf/kubelet.service</code>
把 <code>ExecStartPre=sh</code> 改成 <code>ExecStartPre=/bin/bash</code></p> <blockquote><p>calico无法启动</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@k8s03 ~]# kubectl logs calico-node-v4s8w -n kube-system
Error from server (BadRequest): container &quot;calico-node&quot; in pod &quot;calico-node-v4s8w&quot; is waiting to start: PodInitializing
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Unable to update cni config: No networks found in /etc/cni/net.d
</code></pre></div><p>这是由于init container初始化失败， 把正常借点的/etc/cni拷贝到不正常的节点即可.</p> <blockquote><p>prometheus pod都正常就是没监控数据</p></blockquote> <p>可能是服务器时间没同步，同步下时间杀pod即可</p> <blockquote><p>ssh执行失败,no supported methods remain</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Error create ssh session failed ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain
</code></pre></div><p>原因找到，master与node机器密码必须一致，如果使用--passwd参数的话，密码不一样请使用免密钥，github.com/fanux/sealos/README.md 上有详细说明</p> <blockquote><p>ubuntu kubelet启动不了</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>/usr/bin/kubelet-pre-start.sh: 行 17: setenforce: 未找到命   
</code></pre></div><p>因为ubuntu 可能没装setenforce</p> <div class="language- extra-class"><pre class="language-text"><code>在/etc/init.d/停止AppArmor脚本：
sudo /etc/init.d/apparmor stop
从系统中清除AppArmor。
apt purge apparmor
如果您担心配置文件被删除，请使用apt remove apparmor。
更新并重新启动系统：
apt update &amp;&amp; upgrade -yuf
reboot
安装SELinux
安装SELinux软件包并重启系统：
apt install selinux
reboot
您可以通过尝试将SELinux设置为enforcing模式来确定SELinux是否在您的系统上强制执行安全性。
root@ubuntu:~# setenforce 1
root@ubuntu:~# getenforce
Enforcing
</code></pre></div><p>或者</p> <p>如果装不了selinux 就改下压缩包就行，kube/bin/ubelet-pre-start.sh 把这行注释了  然后重新打包。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5766de4b.js" defer></script><script src="/assets/js/2.bc760f0a.js" defer></script><script src="/assets/js/8.dc94d2c7.js" defer></script>
  </body>
</html>
