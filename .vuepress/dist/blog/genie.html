<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CNI 小精灵 genie | sealyun | kubernetes安装</title>
    <meta name="description" content="">
    <meta name="theme-color" content="#007af5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2803648cc5852dd3e9e46bbd0bf63366";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
    <meta property="og:site_name" content="sealyun 专注于kubernetes安装"><meta property="og:title" content="sealyun kubernetes安装"><meta property="og:type" content="article"><meta property="og:url" content="/blog/genie.html"><meta name="twitter:title" content="sealyun kubernetes安装"><meta name="twitter:url" content="/blog/genie.html"><meta name="twitter:card" content="summary_large_image">
    <link rel="preload" href="/assets/css/0.styles.943dcab2.css" as="style"><link rel="preload" href="/assets/js/app.de51bfc9.js" as="script"><link rel="preload" href="/assets/js/2.bc760f0a.js" as="script"><link rel="preload" href="/assets/js/27.ff73e565.js" as="script"><link rel="prefetch" href="/assets/js/10.ef13dd24.js"><link rel="prefetch" href="/assets/js/11.21e23f3b.js"><link rel="prefetch" href="/assets/js/12.b5da024f.js"><link rel="prefetch" href="/assets/js/13.ac0928d5.js"><link rel="prefetch" href="/assets/js/14.713b31cb.js"><link rel="prefetch" href="/assets/js/15.5398ac16.js"><link rel="prefetch" href="/assets/js/16.1dc38eef.js"><link rel="prefetch" href="/assets/js/17.e6bc3cab.js"><link rel="prefetch" href="/assets/js/18.516e4d74.js"><link rel="prefetch" href="/assets/js/19.15e67b8e.js"><link rel="prefetch" href="/assets/js/20.55bcff54.js"><link rel="prefetch" href="/assets/js/21.863606ad.js"><link rel="prefetch" href="/assets/js/22.41367627.js"><link rel="prefetch" href="/assets/js/23.f9eb92a4.js"><link rel="prefetch" href="/assets/js/24.6f82ed67.js"><link rel="prefetch" href="/assets/js/25.7efbfaa3.js"><link rel="prefetch" href="/assets/js/26.38154d75.js"><link rel="prefetch" href="/assets/js/28.273c5dbf.js"><link rel="prefetch" href="/assets/js/29.143e1388.js"><link rel="prefetch" href="/assets/js/3.b7a496ec.js"><link rel="prefetch" href="/assets/js/30.f063c1af.js"><link rel="prefetch" href="/assets/js/31.72396ffc.js"><link rel="prefetch" href="/assets/js/32.b02da6aa.js"><link rel="prefetch" href="/assets/js/33.e9f753d9.js"><link rel="prefetch" href="/assets/js/34.7433605c.js"><link rel="prefetch" href="/assets/js/35.77ea75db.js"><link rel="prefetch" href="/assets/js/36.239965b2.js"><link rel="prefetch" href="/assets/js/37.749deb90.js"><link rel="prefetch" href="/assets/js/38.cab76e22.js"><link rel="prefetch" href="/assets/js/39.eaec16a3.js"><link rel="prefetch" href="/assets/js/4.1ba98b6c.js"><link rel="prefetch" href="/assets/js/40.c879980c.js"><link rel="prefetch" href="/assets/js/41.0d571f5c.js"><link rel="prefetch" href="/assets/js/42.df873913.js"><link rel="prefetch" href="/assets/js/43.feb51310.js"><link rel="prefetch" href="/assets/js/44.0ee98395.js"><link rel="prefetch" href="/assets/js/45.f71bf549.js"><link rel="prefetch" href="/assets/js/46.610ed55e.js"><link rel="prefetch" href="/assets/js/47.542e4595.js"><link rel="prefetch" href="/assets/js/48.e359d87e.js"><link rel="prefetch" href="/assets/js/49.37e265f2.js"><link rel="prefetch" href="/assets/js/5.c532b727.js"><link rel="prefetch" href="/assets/js/50.deab782e.js"><link rel="prefetch" href="/assets/js/51.fc6ff3f4.js"><link rel="prefetch" href="/assets/js/52.41b88a68.js"><link rel="prefetch" href="/assets/js/53.f43dbd20.js"><link rel="prefetch" href="/assets/js/54.34f69a2e.js"><link rel="prefetch" href="/assets/js/55.4687e03e.js"><link rel="prefetch" href="/assets/js/56.ba4ed7f2.js"><link rel="prefetch" href="/assets/js/57.80234674.js"><link rel="prefetch" href="/assets/js/58.7101efe9.js"><link rel="prefetch" href="/assets/js/59.925d462e.js"><link rel="prefetch" href="/assets/js/6.b9e9e0d5.js"><link rel="prefetch" href="/assets/js/60.940cada4.js"><link rel="prefetch" href="/assets/js/61.65266f72.js"><link rel="prefetch" href="/assets/js/62.490c362f.js"><link rel="prefetch" href="/assets/js/63.62353006.js"><link rel="prefetch" href="/assets/js/64.07f431ae.js"><link rel="prefetch" href="/assets/js/65.337f99f3.js"><link rel="prefetch" href="/assets/js/66.c36f7211.js"><link rel="prefetch" href="/assets/js/67.3009b3ec.js"><link rel="prefetch" href="/assets/js/68.8bb3e997.js"><link rel="prefetch" href="/assets/js/7.36e0fd48.js"><link rel="prefetch" href="/assets/js/8.f29a71a6.js"><link rel="prefetch" href="/assets/js/9.0825aa57.js">
    <link rel="stylesheet" href="/assets/css/0.styles.943dcab2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://sealyun.com/img/logo.png" alt="sealyun | kubernetes安装" class="logo"> <span class="site-name can-hide">sealyun | kubernetes安装</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">使用文档</a></div><div class="nav-item"><a href="https://blog.sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://store.lameleg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  离线包下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/faq/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">版本变更</a></div><div class="nav-item"><a href="/github/" class="nav-link">开源项目</a></div><div class="nav-item"><a href="/contact/" class="nav-link">联系方式</a></div><div class="nav-item"><a href="http://store.lameleg.com:8536/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  论坛
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友情连接" class="dropdown-title"><span class="title">友情连接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://fuckcloudnative.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  云原生实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kuboard.cn/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kuboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.qikqiak.com/?utm_source=sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阳明的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://zhangguanzhang.github.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张馆长的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">使用文档</a></div><div class="nav-item"><a href="https://blog.sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://store.lameleg.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  离线包下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/faq/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">版本变更</a></div><div class="nav-item"><a href="/github/" class="nav-link">开源项目</a></div><div class="nav-item"><a href="/contact/" class="nav-link">联系方式</a></div><div class="nav-item"><a href="http://store.lameleg.com:8536/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  论坛
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友情连接" class="dropdown-title"><span class="title">友情连接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://fuckcloudnative.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  云原生实验室
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://kuboard.cn/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kuboard
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.qikqiak.com/?utm_source=sealyun.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阳明的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://zhangguanzhang.github.io/#sealyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  张馆长的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/" class="sidebar-link">博客列表</a></li><li><a href="/blog/CI-CD.html" class="sidebar-link">CI 概述</a></li><li><a href="/blog/calico.html" class="sidebar-link">calico 网络原理</a></li><li><a href="/blog/calico-architecture.html" class="sidebar-link">calico架构</a></li><li><a href="/blog/calico-network-policy.html" class="sidebar-link">calico网络策略</a></li><li><a href="/blog/client-go-crd.html" class="sidebar-link">使用client-go包访问Kubernetes CRD</a></li><li><a href="/blog/cni.html" class="sidebar-link">CNI详细介绍</a></li><li><a href="/blog/container-stop-timeout.html" class="sidebar-link">容器信号使用</a></li><li><a href="/blog/containerd.html" class="sidebar-link">containerd与kubernetes集成</a></li><li><a href="/blog/crd.html" class="sidebar-link">使用kubebuilder开发CRD</a></li><li><a href="/blog/csi.html" class="sidebar-link">CSI详解</a></li><li><a href="/blog/dev-k8s-workflow.html" class="sidebar-link">kubernetes开发流程</a></li><li><a href="/blog/docker-architech.html" class="sidebar-link">Docker架构分析</a></li><li><a href="/blog/docker-dev.html" class="sidebar-link">docker开发流程</a></li><li><a href="/blog/docker-network.html" class="sidebar-link">容器网络概述</a></li><li><a href="/blog/docker-oerlay2.html" class="sidebar-link">关于overlay2存储驱动的磁盘配额问题</a></li><li><a href="/blog/docker-ovs.html" class="sidebar-link">ovs对接容器网络</a></li><li><a href="/blog/etcd-manage.html" class="sidebar-link">etcd管南</a></li><li><a href="/blog/fist-terminal.html" class="sidebar-link">属于极客的k8s管理工具fist</a></li><li><a href="/blog/genie.html" class="active sidebar-link">CNI 小精灵 genie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/genie.html#为什么要有genie" class="sidebar-link">为什么要有genie</a></li><li class="sidebar-sub-header"><a href="/blog/genie.html#使用介绍" class="sidebar-link">使用介绍</a></li><li class="sidebar-sub-header"><a href="/blog/genie.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/blog/istio-quickstart.html" class="sidebar-link">istio安装使用教程</a></li><li><a href="/blog/k8s-authenticating.html" class="sidebar-link">kubernetes对接第三方认证</a></li><li><a href="/blog/k8s-ha-conf.html" class="sidebar-link">kubernetes高可用相关配置</a></li><li><a href="/blog/k8s-ipvs.html" class="sidebar-link">kubernetes ipvs设置</a></li><li><a href="/blog/k8s-rbac.html" class="sidebar-link">kubernetes RBAC实战</a></li><li><a href="/blog/keepalived.html" class="sidebar-link">keepalived in docker</a></li><li><a href="/blog/kube-admin-control.html" class="sidebar-link">kubernetes Admission Controller原理介绍</a></li><li><a href="/blog/kube-batch.html" class="sidebar-link">kube-scheduler定制，支持深度学习批处理任务调度</a></li><li><a href="/blog/kube-cmd.html" class="sidebar-link">老夫k8s命令行賊6</a></li><li><a href="/blog/kube-dev.html" class="sidebar-link">kubernetes开发指南</a></li><li><a href="/blog/kube-proxy-src.html" class="sidebar-link">kube-proxy源码解析</a></li><li><a href="/blog/kube-scheduler-source-code.html" class="sidebar-link">kubernetes源码分析之kube-scheduler - 从代码看原理</a></li><li><a href="/blog/kubeadm.html" class="sidebar-link">kubeadm杂谈</a></li><li><a href="/blog/kubeadm-dev.html" class="sidebar-link">修改kubeadm证书过期时间</a></li><li><a href="/blog/kubeadm-source.html" class="sidebar-link">kubeadm源码分析</a></li><li><a href="/blog/kubernetes-vm.html" class="sidebar-link">强隔离容器的那些事</a></li><li><a href="/blog/kustomize.html" class="sidebar-link">kustomize 颤抖吧helm!</a></li><li><a href="/blog/libra.html" class="sidebar-link">facebook libra尝鲜，没赶上比特币能不能上这趟车</a></li><li><a href="/blog/macvtap.html" class="sidebar-link">macvtap实践教程</a></li><li><a href="/blog/ovn-vni.html" class="sidebar-link">从CNI到ovn</a></li><li><a href="/blog/prometheus-operator-envoy.html" class="sidebar-link">使用prometheus operator监控envoy</a></li><li><a href="/blog/rook.html" class="sidebar-link">rook使用教程，快速编排ceph</a></li><li><a href="/blog/rpc-protobuf.html" class="sidebar-link">golang基于protobuf的rpc使用</a></li><li><a href="/blog/runc.html" class="sidebar-link">runc 架构</a></li><li><a href="/blog/scratch.html" class="sidebar-link">scratch镜像</a></li><li><a href="/blog/tektoncd-pipeline.html" class="sidebar-link">tektoncd pipeline教程 - kubernetes原生pipeline</a></li><li><a href="/blog/user-token.html" class="sidebar-link">kubernetes 用户token教程</a></li><li><a href="/blog/vim.html" class="sidebar-link">是时候表现一下我的vim了</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cni-小精灵-genie"><a href="#cni-小精灵-genie" class="header-anchor">#</a> CNI 小精灵 genie</h1> <p>想同时使用多个CNI? 想往容器里塞多张网卡？试试这款CNI插件 <a href="https://github.com/cni-genie/CNI-Genie" target="_blank" rel="noopener noreferrer">CNI-Genie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>genie可以引用CNI插件，包含默认CNI插件如（bridge macvlan ipvlan loopback）第三方插件如 calico,romana,weave-net</p> <p>或者一些专用CNI插件如SR-IOV,DPDK等，可以调用在宿主机上的任意CNI插件.</p> <p>甚至可以让容器一让网卡通过calico分配，另一张网卡走flannel走。</p> <h2 id="为什么要有genie"><a href="#为什么要有genie" class="header-anchor">#</a> 为什么要有genie</h2> <h3 id="多网卡与cni任意选择"><a href="#多网卡与cni任意选择" class="header-anchor">#</a> 多网卡与CNI任意选择</h3> <p>现在，在node节点上运行的kubelet最多只连接一个CNI插件，即Canal或Romana或Weave。CNI-Genie可以在运行时选用在该特定节点上运行的任何现有CNI插件。</p> <p>当前Kubernetes无法做到这一点的原因是，当您启动kubelet时，您需要将cni-plugin详细信息作为“kubelet”进程的一部分传递。在这种情况下，您只需选择一个现有的CNI插件，并将其传递给kubelet。如果我们想让某些pod使用Canal网络和其他一组pod来使用weave网络怎么办？这在Kubernetes目前是不可能的。对于任何多网络支持，我们需要对Kubernetes进行更改，这会导致向后兼容性问题。</p> <p>因此，CNI-Genie“多个CNI插件”功能旨在解决此问题，而无更改及Kubernetes代码</p> <p><img src="https://github.com/cni-genie/CNI-Genie/raw/master/docs/multiple-cni-plugins/what-cni-genie.png" alt=""></p> <ul><li>用户可能不同场景对网络需求不同，如我们的一个场景，有些用户需要pod漂移保持ip不变，这样我们让其走ovn网络，有些云原生应用不关心地址变动就走calico</li> <li>访问的网络不同，如一个业务处理业务走的是业务网（千兆），把数据存储到大数据平台走的存储网（25G），这样给容器同时分配两张网卡</li> <li>不同的CNI插件在端口映射，NAT，隧道，中断主机端口/接口的需求方面是不同的</li></ul> <p>如下：</p> <blockquote><p>控制面数据面网卡分离</p></blockquote> <p><img src="https://github.com/cni-genie/CNI-Genie/blob/master/docs/multiple-ips/multi-interface.PNG" alt=""></p> <blockquote><p>高速网络与低速分离</p></blockquote> <p><img src="https://github.com/cni-genie/CNI-Genie/raw/master/docs/multiple-ips/multi-interface.PNG" alt=""></p> <blockquote><p>流媒体控制流与数据流分离</p></blockquote> <p><img src="https://github.com/cni-genie/CNI-Genie/raw/master/docs/multiple-ips/multi-interface.PNG" alt=""></p> <h3 id="network-attachment-definitions"><a href="#network-attachment-definitions" class="header-anchor">#</a> Network Attachment Definitions</h3> <p>NetworkAttachmentDefinition 是一个用户可指定网络配置的CRD,然后pod选用该CRD. 这块一般人我不告诉他。</p> <h3 id="smart-cni"><a href="#smart-cni" class="header-anchor">#</a> Smart CNI</h3> <p>根据用户关注的性能指标自动选择CNI,例如占用率，子网数量，延迟，带宽这些“KPI” 去选择CNI</p> <h3 id="网络隔离"><a href="#网络隔离" class="header-anchor">#</a> 网络隔离</h3> <p>为租户提供专用的“物理”网络
在共享的“物理”网络上为不同租户隔离的“逻辑”网络</p> <h3 id="网络级acl"><a href="#网络级acl" class="header-anchor">#</a> 网络级ACL</h3> <p>用于网络级ACL的CNI-Genie网络策略引擎</p> <h3 id="针对给定workload在不同（物理或逻辑）网络之间进行实时切换"><a href="#针对给定workload在不同（物理或逻辑）网络之间进行实时切换" class="header-anchor">#</a> 针对给定workload在不同（物理或逻辑）网络之间进行实时切换</h3> <p>价格最小化：随着网络价格的变化，将工作负载动态切换到更便宜的网络
最大化网络利用率：在阈值时动态地将工作负载切换到较不拥挤的网络</p> <p><img src="https://github.com/cni-genie/CNI-Genie/raw/master/docs/network-switching.PNG" alt=""></p> <h2 id="使用介绍"><a href="#使用介绍" class="header-anchor">#</a> 使用介绍</h2> <p>安装略</p> <p>下面针对几个主要功能对genie进行介绍：</p> <h3 id="多网卡与cni选择"><a href="#多网卡与cni选择" class="header-anchor">#</a> 多网卡与CNI选择</h3> <p>选择不同的CNI只需要在pod中加一个annotations即可</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx-canal-master
  labels:
    app: web
  annotations:
    cni: &quot;canal&quot;
spec:
  containers:
    - name: key-value-store
      image: nginx:latest
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 6379
</code></pre></div><p><img src="https://github.com/cni-genie/CNI-Genie/raw/master/docs/CNIGenieDetailedWorkflow.png" alt=""></p> <p>上图最重要的就是4，5，6三个步骤：</p> <ol start="4"><li>kubelet调用CNI Genie</li> <li>CNI Genie调用apiserver根据pod名查询pod annotations</li> <li>genie去调用真正的CNI</li> <li>返回结果给kubelet</li> <li>返回网络信息给apiserver写入etcd</li></ol> <p>多网卡不同CNI：</p> <div class="language- extra-class"><pre class="language-text"><code>  annotations:
    cni: &quot;weave,canal&quot;
</code></pre></div><p>kubectl get pod只会显示一个ip, describe能看到两张网卡的ip：</p> <div class="language- extra-class"><pre class="language-text"><code>annotations:     
    cni: canal,weave
    multi-ip-preferences: '{&quot;multi_entry&quot;:2,&quot;ips&quot;:{&quot;&quot;:{},&quot;ip1&quot;:{&quot;ip&quot;:&quot;10.244.0.201&quot;,&quot;interface&quot;:&quot;eth0&quot;},&quot;ip2&quot;:{&quot;ip&quot;:&quot;10.32.0.4&quot;,&quot;interface&quot;:&quot;eth1&quot;}}}'                                    
</code></pre></div><p>进容器也可以看到两张网卡了：</p> <div class="language- extra-class"><pre class="language-text"><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                             
    inet 127.0.0.1/8 scope host lo                                                   
       valid_lft forever preferred_lft forever                                      
    inet6 ::1/128 scope host                                                       
       valid_lft forever preferred_lft forever                                    
3: eth0@if49589: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1400 qdisc noqueue state UP group default   
    link/ether 7e:99:f7:87:81:c6 brd ff:ff:ff:ff:ff:ff                                            
    inet 10.244.0.201/32 scope global eth0                                                       
       valid_lft forever preferred_lft forever                                                  
    inet6 fe80::7c99:f7ff:fe87:81c6/64 scope link                                              
       valid_lft forever preferred_lft forever                                                
49590: eth1@if49591: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1376 qdisc noqueue state UP group default  
    link/ether 36:b0:8c:f0:9f:58 brd ff:ff:ff:ff:ff:ff                                               
    inet 10.32.0.4/12 scope global eth1                                                             
       valid_lft forever preferred_lft forever                                                     
    inet6 fe80::34b0:8cff:fef0:9f58/64 scope link                                                 
       valid_lft forever preferred_lft forever 
</code></pre></div><h3 id="通过crd定义网卡"><a href="#通过crd定义网卡" class="header-anchor">#</a> 通过CRD定义网卡</h3> <p>定义一个NAD(NetworkAttachmentDefinition)</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: &quot;k8s.cni.cncf.io/v1&quot;
kind: NetworkAttachmentDefinition
metadata:
  name: weavenet
spec:
  config: '{
    &quot;cniVersion&quot;: &quot;0.3.0&quot;,
    &quot;plugins&quot;: [
        {
            &quot;name&quot;: &quot;weave&quot;,
            &quot;type&quot;: &quot;weave-net&quot;,
            &quot;hairpinMode&quot;: true
        },
        {
            &quot;type&quot;: &quot;portmap&quot;,
            &quot;capabilities&quot;: {&quot;portMappings&quot;: true},
            &quot;snat&quot;: true
        }
    ]
}
'
</code></pre></div><p>pod使用该NAD,还可指定默认插件，没写annotation就走默认CNI</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx-netattachdef-flannel-weave
  annotations:
    k8s.v1.cni.cncf.io/networks: flannel@eth1, network/weavenet@eth5
spec:
  containers:
    - name: key-value-store
      image: nginx:latest
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 80
</code></pre></div><h3 id="智能cni选择"><a href="#智能cni选择" class="header-anchor">#</a> 智能CNI选择</h3> <p>CNI-Genie可以与cAdvisor交互，收集每个容器的网络使用信息,以决定网络走哪个CNI</p> <p>支持以下KPI：</p> <ul><li>网络延迟</li> <li>网络带宽</li> <li>端到端响应时间</li> <li>使用的IP地址百分比，即（使用的IP地址数）/（IP地址总数）</li> <li>入住率</li> <li>用户填写问卷以查找用例优化的CNI插件</li></ul> <p>使用时直接不指定CNI即可</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx-smart-pick
  labels:
    app: web
  annotations:
    cni: &quot;&quot;
</code></pre></div><p>你可以把一个CNI的流量打满，那么新创建的pod就会自动选择别的CNI</p> <h3 id="从指定ip地址池内分配地址"><a href="#从指定ip地址池内分配地址" class="header-anchor">#</a> 从指定IP地址池内分配地址</h3> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: alpha.network.k8s.io/v1
kind: Logicalnetwork
metadata:
  name: net1
  namespace: default
spec:
  physicalNet: &quot;phynet1&quot;
  sub_subnet: &quot;10.32.0.0/24&quot;
</code></pre></div><p>pod 使用时用 networks字段指定即可</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx-single-network-pod
  labels:
    app: web
  annotations:
    cni: &quot;&quot;
    networks: net1
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>genie在很多复杂网络场景还是非常有作用的，我们主要用其来管理虚拟机网络，以达到虚拟机与容器在同一个平台上运行</p> <p>探讨可加QQ群：98488045</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/fist-terminal.html" class="prev">属于极客的k8s管理工具fist</a></span> <span class="next"><a href="/blog/istio-quickstart.html">istio安装使用教程</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.de51bfc9.js" defer></script><script src="/assets/js/2.bc760f0a.js" defer></script><script src="/assets/js/27.ff73e565.js" defer></script>
  </body>
</html>
