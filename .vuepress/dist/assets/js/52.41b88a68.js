(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{249:function(a,s,t){"use strict";t.r(s);var e=t(0),l=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"scratch镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scratch镜像"}},[a._v("#")]),a._v(" scratch镜像")]),a._v(" "),t("p",[a._v("很容器想到from scratch, 就是没任何基础镜像")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('FROM scratch\nCOPY p /\nENTRYPOINT ["/p"]\n')])])]),a._v(" "),t("p",[a._v("有几点要注意：")]),a._v(" "),t("ul",[t("li",[a._v("ENTRYPOINT 或者CMD 必须要用[]这种模式，如果直接/p会用sh去启动，而scratch没有shell导致失败")]),a._v(" "),t("li",[a._v("二进制程序必须静态编译，也就是不能依赖libc什么的动态库")])]),a._v(" "),t("p",[a._v("动态编译的bin程序：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[root@dev-86-205 ci-sftp]# ldd p\n    linux-vdso.so.1 =>  (0x00007ffd6ef7b000)\n    libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa28f94e000)\n    libc.so.6 => /lib64/libc.so.6 (0x00007fa28f58d000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fa28fb72000)\n")])])]),t("p",[a._v("这种情况下出来的bin程序可能会出现问题：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('standard_init_linux.go:175: exec user process caused "no such file or directory”\n')])])]),t("p",[a._v("静态编译的bin程序,这是我们scratch需要的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[root@dev-86-205 ci-sftp]# ldd p\n    不是动态可执行文件\n")])])]),t("p",[a._v("golang中静态编译命令：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("go build --ldflags '-linkmode external -extldflags \"-static”'\n")])])]),t("p",[a._v("如果不静态编译那可能得拷贝一堆动态库到镜像中，很多lowB就是那么做的")])])}),[],!1,null,null,null);s.default=l.exports}}]);